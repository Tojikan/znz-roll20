





<div class="sheet-character">
    <div class="character-status-bar">
        <div class="stage">
            

    
<div class="stats-section">
    <div class="stage">
        
    <div class="stat-tracker box health">
        <div class="stat-label label-text">
            Health 
            
        </div>
        <div class="stat-wrapper">
            <div class="main">
                <input type="number" class="shy" name="attr_health" value="100"/>
            </div>
            
                <div class="sub">
                    Max:
                    <input type="number" class="shy" name="attr_health_max" value="100"/>
                </div>
            
        </div>
    </div>

        
    <div class="stat-tracker box fatigue">
        <div class="stat-label label-text">
            Fatigue 
            
        </div>
        <div class="stat-wrapper">
            <div class="main">
                <input type="number" class="shy" name="attr_fatigue" value="0"/>
            </div>
            
        </div>
    </div>

        
    <div class="stat-tracker box trauma">
        <div class="stat-label label-text">
            Trauma 
            
        </div>
        <div class="stat-wrapper">
            <div class="main">
                <input type="number" class="shy" name="attr_trauma" value="0"/>
            </div>
            
        </div>
    </div>

        
    <div class="stat-tracker box actions">
        <div class="stat-label label-text">
            Actions 
            <button type="action" name="act_refreshAP">refresh</button>
        </div>
        <div class="stat-wrapper">
            <div class="main">
                <input type="number" class="shy" name="attr_actions" value="3"/>
            </div>
            
                <div class="sub">
                    Max:
                    <input type="number" class="shy" name="attr_actions_max" value="3"/>
                </div>
            
        </div>
    </div>

    </div>
</div>

<div class="roll-section">
    <div class="stage">
        <div class="roll-input-row"><span>Bonus Rolls:</span> <input type="number" class="shy underline" name="attr_rollmod"/></div>
        <div class="roll-input-row">
            <span>Roll Type:</span> 
            <div class="btn-radiobutton-row">
                <div class="control btn-radiobutton">
                    <input class="btn-radiobutton-input cost-1" type="radio" name="attr_[object Object]" value="1" checked="checked">
                    <div class="btn-radiobutton-label cost-1">Active</div>
                </div>
                <div class="control btn-radiobutton">
                    <input class="btn-radiobutton-input cost-0" type="radio" name="attr_[object Object]" value="0">
                    <div class="btn-radiobutton-label cost-0">Free</div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="ammo-section">
    <div class="box">
        <div class="ammo-label">Ammo</div>
        <div class="ammo-list sheet-list">
            
                <div class="sheet-line">
                    <div class="sheet-label">Light</div>
                    <input type="number" name="attr_ammo_light" value="0"/>
                </div>
            
                <div class="sheet-line">
                    <div class="sheet-label">Medium</div>
                    <input type="number" name="attr_ammo_medium" value="0"/>
                </div>
            
                <div class="sheet-line">
                    <div class="sheet-label">Heavy</div>
                    <input type="number" name="attr_ammo_heavy" value="0"/>
                </div>
            
        </div>
    </div>
</div>
        </div>
    </div>


    <div class="layout">
        <div class="sidebar">
            <div class="character-skills">
                <div class="stage">
                    





    <div class="dice-pool-row">
        <div class="pool-amount">
            <input type="number" name="attr_body" value="10">
        </div>
        <div class="pool-label">
            <span>Body</span>
        </div>
    </div>

    <div class="skill-list">
        <div class="skill-row">
            <div class="skill-label">Athletics</div>
            <div class="skill-amount"><input type="number" name="attr_skills_athletics" value="2"></div>
        </div><div class="skill-row">
            <div class="skill-label">Blocking</div>
            <div class="skill-amount"><input type="number" name="attr_skills_blocking" value="2"></div>
        </div><div class="skill-row">
            <div class="skill-label">Dodging</div>
            <div class="skill-amount"><input type="number" name="attr_skills_dodging" value="2"></div>
        </div><div class="skill-row">
            <div class="skill-label">Endurance</div>
            <div class="skill-amount"><input type="number" name="attr_skills_endurance" value="2"></div>
        </div><div class="skill-row">
            <div class="skill-label">Melee Combat</div>
            <div class="skill-amount"><input type="number" name="attr_skills_melee" value="2"></div>
        </div><div class="skill-row">
            <div class="skill-label">Ranged Combat</div>
            <div class="skill-amount"><input type="number" name="attr_skills_ranged" value="2"></div>
        </div><div class="skill-row">
            <div class="skill-label">Stealth</div>
            <div class="skill-amount"><input type="number" name="attr_skills_stealth" value="2"></div>
        </div><div class="skill-row">
            <div class="skill-label">Throwing</div>
            <div class="skill-amount"><input type="number" name="attr_skills_throwing" value="2"></div>
        </div>
    </div>


    <div class="dice-pool-row">
        <div class="pool-amount">
            <input type="number" name="attr_spirit" value="10">
        </div>
        <div class="pool-label">
            <span>Spirit</span>
        </div>
    </div>

    <div class="skill-list">
        <div class="skill-row">
            <div class="skill-label">Emotions</div>
            <div class="skill-amount"><input type="number" name="attr_skills_emotions" value="2"></div>
        </div><div class="skill-row">
            <div class="skill-label">Insight</div>
            <div class="skill-amount"><input type="number" name="attr_skills_insight" value="2"></div>
        </div><div class="skill-row">
            <div class="skill-label">Reflexes</div>
            <div class="skill-amount"><input type="number" name="attr_skills_reflexes" value="2"></div>
        </div><div class="skill-row">
            <div class="skill-label">Scouting</div>
            <div class="skill-amount"><input type="number" name="attr_skills_scouting" value="2"></div>
        </div><div class="skill-row">
            <div class="skill-label">Social Skills</div>
            <div class="skill-amount"><input type="number" name="attr_skills_socialskills" value="2"></div>
        </div><div class="skill-row">
            <div class="skill-label">Survival</div>
            <div class="skill-amount"><input type="number" name="attr_skills_survival" value="2"></div>
        </div><div class="skill-row">
            <div class="skill-label">Tenacity</div>
            <div class="skill-amount"><input type="number" name="attr_skills_tenacity" value="2"></div>
        </div><div class="skill-row">
            <div class="skill-label">Thievery</div>
            <div class="skill-amount"><input type="number" name="attr_skills_thievery" value="2"></div>
        </div>
    </div>


    <div class="dice-pool-row">
        <div class="pool-amount">
            <input type="number" name="attr_mind" value="10">
        </div>
        <div class="pool-label">
            <span>Mind</span>
        </div>
    </div>

    <div class="skill-list">
        <div class="skill-row">
            <div class="skill-label">Crafting</div>
            <div class="skill-amount"><input type="number" name="attr_skills_crafting" value="2"></div>
        </div><div class="skill-row">
            <div class="skill-label">Engineering</div>
            <div class="skill-amount"><input type="number" name="attr_skills_engineering" value="2"></div>
        </div><div class="skill-row">
            <div class="skill-label">Investigation</div>
            <div class="skill-amount"><input type="number" name="attr_skills_investigation" value="2"></div>
        </div><div class="skill-row">
            <div class="skill-label">Learning</div>
            <div class="skill-amount"><input type="number" name="attr_skills_learning" value="2"></div>
        </div><div class="skill-row">
            <div class="skill-label">Medicine</div>
            <div class="skill-amount"><input type="number" name="attr_skills_medicine" value="2"></div>
        </div><div class="skill-row">
            <div class="skill-label">Nature</div>
            <div class="skill-amount"><input type="number" name="attr_skills_nature" value="2"></div>
        </div><div class="skill-row">
            <div class="skill-label">Science</div>
            <div class="skill-amount"><input type="number" name="attr_skills_science" value="2"></div>
        </div><div class="skill-row">
            <div class="skill-label">Vehicles</div>
            <div class="skill-amount"><input type="number" name="attr_skills_vehicles" value="2"></div>
        </div>
    </div>

                </div>    
            </div>
        </div>

        <div class="main">
        </div>


        <div class="sidebar">
        
        </div>
    
    </div>



    
</div>


<script type="text/worker">
    /** inject:workers **/
    (function () {
    'use strict';

    function capitalize(str) {
        return str.charAt(0).toUpperCase() + str.slice(1);

    }

    class Model {
        constructor(model){
            this.model = model;
        }
        
        /**
         * Exports a model's fields into JSON. Generates an ID and label for each top level key in an object.
         * 
         * @returns 
         */
        toJson(){
            let keys = Object.keys(this.model);
            let retVal = {};
            
            // Inner function for setting ID and Label
            const setupField = function(key, obj, prefix=''){
                let result = {...obj};
                
                //Set ID based on key if none provided
                if (!('id' in obj)){
                    result.id = key;
                }
            
                //Set label based on key if none provided
                if (!('label' in obj)){
                    result.label = capitalize(key);
                }   
            
                //Add prefix to the id.
                if (prefix.length){
                    result.id = `${prefix}_${result.id}`;
                }
                
                return result;
            };
            
            for (let k of keys){
                let obj = this.model[k];
                
                //For lists fields (such as skills), set up for each item in the list
                if (obj && 'list' in obj){
                    retVal[k] = {...obj, list:{}};
            
                    for (let opt of Object.keys(obj.list)){
                        //add a prefix to the option id
                        retVal[k].list[opt] = setupField(`${opt}`, obj.list[opt], k);
                    }
                } else {
                    retVal[k] = setupField(k, obj);
                }
            }
            
            return retVal;

        }
    }

    // import { capitalize } from "lodash";


    const Character = new Model(
        {
            health: {
                default: 100,
                max: true
            },
            fatigue: {
                affects: 'rolls'
            },
            trauma: {
                affects: 'success'
            },
            actions: {
                max: true,
                default: 3,
                action: 'refreshAP',
                actionlabel: 'refresh'
            },
            rollmod: {},
            rollcost: {},
            ammo: {
                list: {
                    light: {},
                    medium: {},
                    heavy: {}
                }
            },
            body: { default: 10 },
            mind: { default: 10 },
            spirit: { default: 10 },
            skills: {
                list: {
                    melee: { uses: 'body', label: 'Melee Combat'},
                    blocking: { uses: 'body' },
                    dodging: { uses: 'body' },
                    ranged: { uses: 'body', label: 'Ranged Combat' },
                    throwing: { uses: 'body' },
                    athletics: { uses: 'body' },
                    endurance: { uses: 'body' },
                    stealth: { uses: 'body' },
                    
                    crafting: { uses: 'mind' },
                    learning: { uses: 'mind' },
                    vehicles: { uses: 'mind' },
                    engineering: { uses: 'mind' },
                    science: { uses: 'mind' },
                    medicine: { uses: 'mind' },
                    investigation: { uses: 'mind' },
                    nature: { uses: 'mind' },
                    
                    scouting: { uses: 'spirit' },
                    reflexes: { uses: 'spirit' },
                    tenacity: { uses: 'spirit' },
                    socialskills: {uses: 'spirit', label: 'Social Skills'},
                    thievery: { uses: 'spirit' },
                    emotions: {uses: 'spirit'},
                    insight: {uses: 'spirit'},
                    survival: { uses: 'spirit' }
                }
            }
        }
    );

    // export const CharacterModel = {
        // notes: {},
        // ammo: {
        //     type: 'list',
        //     list: {
        //         light:{},
        //         medium:{},
        //         heavy:{},
        //         arrow:{}
        //     }
        // },
        // health: {
        //     type: 'max'
        // },
        // fatigue: {
        //     type: 'max'
        // },
        // actions: {
        //     type: 'max'
        // },
        // equipmentslots: {
        //     default: 2,
        //     max: 6
        // },
        // inventoryslots: {
        //     default: 5,
        //     max: 12
        // },
        // ability: {
        //     options: {
        //         _default: {
        //             label: "Select an ability"
        //         },
        //         scavenger: {
        //             description: "Draw 1 additional cards when you scavenge. If you are scavenging a location alone, draw 3."
        //         },
        //         sniper: {
        //             description: "Take aim - don't take any actions this turn. Roll them as free ranged attack actions next turn. You lose these free attacks if you do any action other than ranged attack prior to using them."
        //         }
        //     }
        // },
        // combatskills: {
        //     type:'list',
        //     list: {
        //         guard: {
        //             label: "Guard"
        //         },
        //         throw: {
        //             label: "Throw"
        //         },
        //         blunt: {
        //             label: "Blunt Melee"
        //         },
        //         firearm: {
        //             label: "Firearm"
        //         },
        //         sharp: {
        //             label: "Sharp Melee"
        //         },
        //         unarmed: {
        //             label: "Unarmed"
        //         },
        //         projectile: {
        //             label: "Projectile"
        //         }
        //     }
        // },
        // skills: {
        //     type: 'list',
        //     list: {
        //         lockpick: {
        //             label: "Lockpick"
        //         },
        //         scout: {
        //             label: "Scout"
        //         },
        //         stealth: {
        //             label: "Stealth"
        //         },
        //         social: {
        //             label: "Social"
        //         },
        //         firstaid: {
        //             label: "First Aid"
        //         },
        //         construction: {
        //             label: "Construction"
        //         },
        //         hacking: {
        //             label: "Hacking"
        //         },
        //         athletics: {
        //             label: "Athletics"
        //         }
        //     }
        // }
    // }

    // import { fields as character } from "../model/character";




    function rollwidget(){
        const charModel = Character.toJson();
        const AP = charModel.actions;

        // AP reset
        //reset to max
        on(`clicked:${AP.action}`, function(evInfo){
            console.log('hello');
            getAttrs([AP.id, AP.id + '_max'], function(results){
                setAttrs({
                    [AP.id]: results[AP.id + '_max']
                });
            });
        });

        // fatigue reset
        // reset to 0
        // on(`clicked:${character.actions.resetfatigue.id}`, function(evInfo){
        //     setAttrs({
        //         [character.stats.fatigue.id]: 0
        //     });
        // });


        // Move
        // subtract 1
        // on(`clicked:${character.actions.move.id}`, function(evInfo){
        //     getAttrs([character.stats.ap.id, character.stats.fatigue.id], function(results){
        //         setAttrs({
        //             [character.stats.ap.id]: Math.max(parseInt(results[character.stats.ap.id], 10) - 1, 0),
        //             [character.stats.fatigue.id]: Math.max(parseInt(results[character.stats.fatigue.id], 10) + 3, 0)
        //         });
        //     });
        // });

    }

    // equip().init();
    // limit();
    // // rollOptions();
    // deleteItem();
    // preventNegative();
    rollwidget();

})();

    /** endinject **/
</script>



